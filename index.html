<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Z-Orders Tracker</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<style>
body { font-family: Arial; direction: rtl; background: #eef2f7; padding: 20px; }
.container { max-width: 1200px; margin: auto; }
.box { background: #fff; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 6px 16px rgba(0,0,0,0.1); }
h3 { text-align: center; color: #333; margin-bottom: 20px; }
label { font-weight: bold; color: #555; margin-right: 10px; }
input { width: 100%; padding: 12px; margin-top:5px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; transition: border 0.3s; }
input:focus { border-color: #4CAF50; outline: none; }
button { padding: 10px; cursor: pointer; font-size: 14px; border-radius: 6px; border: none; display: flex; justify-content: center; align-items: center; gap: 6px; transition: all 0.2s ease; }
button:active { transform: scale(0.95); opacity: 0.8; }
.generate-btn { width: calc(50% - 5px); background-color: #4CAF50; color: white; }
.copy-btn { width: calc(50% - 5px); background-color: #2196F3; color: white; }
.copy-btn:hover { background-color: #0b7dda; }
.search-container { display: flex; gap: 10px; margin-top: 15px; }
.search-container input { flex: 1; }
.search-container button { flex: 0 0 120px; background-color:#FF9800; color:white; border-radius:6px; }
.table-wrapper { max-height: 600px; overflow-y: auto; margin-top: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
table, th, td { border: 1px solid #ccc; }
th, td { padding: 12px; text-align: center; }
th { background-color: #4CAF50; color: white; }
tr:nth-child(even) { background-color: #f2f2f2; }
.date-time { white-space: nowrap; }
.order-popup { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-20px); background-color: #4CAF50; color: white; padding: 15px 25px; border-radius: 10px; font-size: 18px; font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.2); opacity: 0; pointer-events: none; transition: all 0.5s ease; z-index: 1000; }
.order-popup.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.last-order { background-color: #FFF59D !important; font-weight:bold; }
.file-buttons { display:flex; gap:10px; margin-top:10px; }
.file-buttons button { background-color:#FF5722; color:white; }
.file-buttons button:hover { background-color:#E64A19; }
#filterDate { width: 150px; display:inline-block; margin-left:10px; padding:6px; font-size:14px; border-radius:6px; border:1px solid #ccc; }
</style>
</head>
<body>

<div class="container">
<div class="box">
<h3>ğŸ”¢ ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø£Ù…Ø±</h3>
<label>Ø§Ù„Ù…Ø¨Ù„Øº:</label>
<input id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<div style="display:flex; gap:10px; margin-top:10px;">
    <button class="generate-btn" onclick="generateOrder()"><i class="fa fa-plus"></i> ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯</button>
    <button class="copy-btn" onclick="copyOrder()"><i class="fa fa-copy"></i> Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±</button>
</div>

<h3 style="margin-top:30px;">ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„ÙŠØ©</h3>
<div class="search-container">
    <input id="searchInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±">
    <button onclick="searchOrder()"><i class="fa fa-search"></i> Ø¨Ø­Ø«</button>
</div>

<h3 style="margin-top:30px;">ğŸ“‹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
<input type="date" id="filterDate" title="Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ù„Ù„ÙÙ„ØªØ±Ø©">
</h3>
<div class="table-wrapper">
<table id="ordersTable">
    <thead>
        <tr>
            <th>Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
<div class="total" id="filteredTotal" style="margin-top:10px;"></div>
</div>

<div class="file-buttons">
    <input type="file" id="importFile" accept=".xlsx">
    <button onclick="importOrders()"><i class="fa fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel</button>
    <button onclick="exportToExcel()"><i class="fa fa-file-export"></i> ØªØµØ¯ÙŠØ± Excel</button>
</div>

</div>

<div id="orderPopup" class="order-popup"></div>

<script>
let lastOrderNumber = "";

// Helper Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
function getToday() {
  const d = new Date();
  return d.getFullYear().toString() +
         String(d.getMonth()+1).padStart(2,'0') +
         String(d.getDate()).padStart(2,'0');
}

// ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø£Ù…Ø±
function generateOrder() {
    const amount = document.getElementById("amount").value.trim();
    if(!amount || isNaN(amount)){ alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ Ø®Ø§Ù†Ø© Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø±Ù‚Ù… ØµØ­ÙŠØ­"); return; }
    const today = getToday();
    const key = "orders_" + today;
    let count = localStorage.getItem(key);
    count = count ? parseInt(count)+1 : 1;
    localStorage.setItem(key,count);

    const orderNumber = `Z-${today}${String(count).padStart(6,'0')}`;
    lastOrderNumber = orderNumber;

    const data = { amount: amount, date: new Date().toLocaleString() };
    localStorage.setItem(orderNumber, JSON.stringify(data));

    document.getElementById("amount").value = "";
    showOrderPopup(orderNumber);
    updateOrdersTable();
}

// Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø± Ù…Ø¤Ù‚Øª
function showOrderPopup(orderNumber) {
    const popup = document.getElementById("orderPopup");
    popup.textContent = `Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±: ${orderNumber}`;
    popup.classList.add("show");
    setTimeout(()=>{ popup.classList.remove("show"); },1500);
}

// Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±
function copyOrder(){
    if(!lastOrderNumber) return;
    navigator.clipboard.writeText(lastOrderNumber);
    const btn = document.querySelector(".copy-btn");
    btn.innerHTML = '<i class="fa fa-check"></i> ØªÙ… Ø§Ù„Ù†Ø³Ø®';
    setTimeout(()=>{ btn.innerHTML = '<i class="fa fa-copy"></i> Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±'; },1000);
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
function updateOrdersTable(filteredDate="") {
    const tbody = document.getElementById("ordersTable").querySelector("tbody");
    tbody.innerHTML = "";
    let totalAmount = 0;

    let orders = [];
    for(let i=0;i<localStorage.length;i++){
        const key = localStorage.key(i);
        if(key.startsWith("Z-")){
            const data = JSON.parse(localStorage.getItem(key));
            orders.push({order:key, amount:data.amount, date:data.date});
        }
    }

    // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ
    orders.sort((a,b)=> b.order.localeCompare(a.order));

    orders.forEach(item=>{
        const orderDate = new Date(item.date).toISOString().slice(0,10);
        if(filteredDate && orderDate !== filteredDate) return;

        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${item.order}</td><td>${item.amount}</td><td class="date-time">${item.date}</td>`;
        tbody.appendChild(tr);
        totalAmount += parseFloat(item.amount);
    });

    document.getElementById("filteredTotal").textContent = filteredDate ? "Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº: " + totalAmount : "";
}

// Ø§Ù„Ø¨Ø­Ø«
function searchOrder(){
    const val = document.getElementById("searchInput").value.trim();
    const tbody = document.getElementById("ordersTable").querySelector("tbody");
    tbody.innerHTML = "";
    if(!val){
        updateOrdersTable();
        return;
    }
    if(localStorage.getItem(val)){
        const data = JSON.parse(localStorage.getItem(val));
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${val}</td><td>${data.amount}</td><td class="date-time">${data.date}</td>`;
        tbody.appendChild(tr);
    } else {
        tbody.innerHTML = `<tr><td colspan="3">âŒ Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</td></tr>`;
    }
}

// ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ
document.getElementById("filterDate").addEventListener("change", function(){
    const selectedDate = this.value;
    updateOrdersTable(selectedDate);
});

// ØªØµØ¯ÙŠØ± Excel
function exportToExcel(){
    let ordersArr = [];
    for(let i=0; i<localStorage.length; i++){
        const key = localStorage.key(i);
        if(key.startsWith("Z-")){
            const data = JSON.parse(localStorage.getItem(key));
            ordersArr.push({ "Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±": key, "Ø§Ù„Ù…Ø¨Ù„Øº": data.amount, "Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª": data.date });
        }
    }

    const worksheet = XLSX.utils.json_to_sheet(ordersArr);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Orders");
    XLSX.writeFile(workbook, "Z-Orders.xlsx");
}

// Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel
function importOrders(){
    const fileInput = document.getElementById("importFile");
    const file = fileInput.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = function(e){
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type:"array"});
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(firstSheet);
        rows.forEach(r=>{
            if(r["Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±"] && r["Ø§Ù„Ù…Ø¨Ù„Øº"] && r["Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª"]){
                localStorage.setItem(r["Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±"], JSON.stringify({amount:r["Ø§Ù„Ù…Ø¨Ù„Øº"], date:r["Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª"]}));
            }
        });
        const selectedDate = document.getElementById("filterDate").value;
        updateOrdersTable(selectedDate);
        alert("âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Excel");
    };
    reader.readAsArrayBuffer(file);
}

// Enter Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ù‚Ù…
document.getElementById("amount").addEventListener("keydown", function(e){ if(e.key==="Enter") generateOrder(); });
// Enter Ù„Ù„Ø¨Ø­Ø«
document.getElementById("searchInput").addEventListener("keydown", function(e){ if(e.key==="Enter") searchOrder(); });

updateOrdersTable();
</script>
</body>
</html>
